<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>SHYA Tap Game</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Orbitron:wght@500&display=swap">
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; }
    body {
      font-family: 'Orbitron', sans-serif;
      background: #000 url('https://i.ibb.co/ymZnKW16/file-00000000c26061f9bc4b0ae925c5943e.png') no-repeat center center/cover;
      height: 100vh;
      overflow: hidden;
      color: #fff;
    }
    .section {
      display: none;
      padding: 20px;
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 65px;
      overflow-y: auto;
      z-index: 1;
    }
    #tapSection { display: block; }

    .top-counters {
  position: absolute;
  top: 10px;
  left: 10px;
  display: flex;
  flex-direction: column; /* ‡§Ø‡§π‡•Ä ‡§≤‡§æ‡§á‡§® ‡§§‡§Ø ‡§ï‡§∞‡§§‡•Ä ‡§π‡•à ‡§ï‡§ø ‡§è‡§ï ‡§ï‡•á ‡§®‡•Ä‡§ö‡•á ‡§è‡§ï ‡§Ü‡§è */
  gap: 8px; /* ‡§¶‡•ã‡§®‡•ã‡§Ç ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§•‡•ã‡§°‡§º‡•Ä ‡§¶‡•Ç‡§∞‡•Ä */
}
    .counter {
      display: flex;
      align-items: center;
      font-size: 16px;
      font-weight: bold;
      text-shadow: 0 0 5px red;
    }
    .counter img {
      width: 38px; height: 38px;
      margin-right: 6px;
    }
    
    .counter6 img{
       width: 28px; height:28px;
       margin-right:6px;
    }

    .right-buttons {
      position: absolute;
      top: 10px; right: 10px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      z-index: 2;
    }
    .right-buttons button {
      padding: 6px 10px;
      font-weight: bold;
      border: none;
      border-radius: 20px;
      background: rgba(0,191,255,0.15);
      box-shadow: 0 0 10px #00bfff;
      color: white;
      cursor: pointer;
    }

    .main-section {
      margin-top: 120px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 10px;
    }
    .energy-bar {
  position: relative;
  width: 200px;
  height: 16px;
  background: #111;
  border-radius: 10px;
  overflow: hidden;
  border: 2px solid #00ffff;
  box-shadow: 0 0 10px #00ffff;
  margin-bottom: 20px;
}
.energy-text {
  position: absolute;
  width: 100%;
  top: 50%;
  left: 0;
  transform: translateY(-50%);
  text-align: center;
  font-size: 14px;
  color: #00ffff;
  font-weight: bold;
  z-index: 10;
  pointer-events: none;
}
    .energy-fill {
      width: 70%;
      height: 100%;
      background: linear-gradient(90deg, #00f6ff, #00ff99);
      animation: pulse 2s infinite ease-in-out;
    }
.tap-text {
  position: absolute;
  color: #00ff00;
  font-size: 16px;
  font-weight: bold;
  animation: floatUp 1s ease-out forwards;
  pointer-events: none;
  z-index: 9999;
}

@keyframes floatUp {
  0% {
    opacity: 1;
    transform: translateY(0px);
  }
  100% {
    opacity: 0;
    transform: translateY(-40px);
  }
}
.coin-upgrade-box {
  background: #1e1e1e;
  padding: 20px;
  border-radius: 12px;
  margin: 10px auto;
  width: 90%;
  max-width: 400px;
  box-shadow: 0 0 10px #00ffcc33;
}
.shop-section {
  padding: 20px;
  background: transparent !important;
  border-radius: 0px;
  margin-top: 100px;
  font-family: 'Orbitron', sans-serif;
  border: none;
  box-shadow: none;
}

.shop-heading {
  color: #fff;
  font-size: 20px;
  margin-bottom: 15px;
  text-align: center;
}

.shop-row {
  background-color: rgba(0, 0, 0, 0.3);
  border-radius: 10px;
  padding: 12px;
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.shop-logo {
  width: 40px;
  height: 40px;
  border-radius: 8px;
}

.shop-amount {
  flex: 1;
  color: #fff;
  font-size: 14px;
  margin-left: 15px;
}

.shop-price {
  color: #00ffaa;
  font-size: 14px;
  margin-right: 10px;
  white-space: nowrap;
}

.shop-buy {
  background-color: #00ffaa;
  color: #000;
  border: none;
  padding: 6px 12px;
  border-radius: 8px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s;
}

.shop-buy:hover {
  background-color: #00ddaa;
}
.task-card {
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: #1f1f1f;
  padding: 15px;
  border-radius: 12px;
  margin: 10px 20px;
  box-shadow: 0 4px 6px rgba(0,0,0,0.2);
}

.task-icon {
  width: 40px;
  height: 40px;
  margin-right: 15px;
}

.task-text {
  flex-grow: 1;
  color: #fff;
}

.task-btn {
  padding: 8px 15px;
  background-color: #2ecc71;
  color: white;
  border: none;
  border-radius: 8px;
  font-weight: bold;
}
#resetButton {
  position: fixed;
  bottom: 20px;
  right: 20px;
  background-color: #ff4d4d;
  color: white;
  border: none;
  padding: 10px 18px;
  font-size: 16px;
  border-radius: 8px;
  cursor: pointer;
  box-shadow: 0 0 10px rgba(255, 0, 0, 0.5);
  z-index: 9999;
}

    @keyframes pulse {
      0% { opacity: 0.6; }
      50% { opacity: 1; }
      100% { opacity: 0.6; }
    }

    .coin-wrapper {
      width: 180px;
      height: 180px;
      cursor: pointer;
    }
    .coin-wrapper img {
      width: 100%;
      height: 100%;
      object-fit: contain;
    }
.auto-tap-btn {
  background: linear-gradient(135deg, #5f72be, #9b23ea);
  color: white;
  border: none;
  padding: 12px 24px;
  font-size: 16px;
  border-radius: 12px;
  cursor: pointer;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
  transition: all 0.2s ease;
  width: 260px;
  margin: 8px auto;
  display: inline-block;
}

.auto-tap-btn:hover {
  transform: scale(1.03);
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.3);
}

    .bottom-images {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      height: 65px;
      background: rgba(0, 0, 0, 0.6);
      display: flex;
      justify-content: space-around;
      align-items: center;
      z-index: 999;
    }
    .image-box {
      width: 55px;
      height: 55px;
      border-radius: 12px;
      overflow: hidden;
      position: relative;
    }
    .image-box img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      border-radius: 12px;
    }

    
  </style>
</head>
<body>

<!-- ‚úÖ Top Counter with Profit Per Hour -->
<div class="top-counters">
  <div class="counter6">
    <img src="https://i.ibb.co/wZDGj5Xy/file-000000008f84622f93729c1d425779dd.png" />
    <span id="counter1">0</span>
  </div>
  <div class="counter">
    <img src="https://i.ibb.co/JwvKv80V/1000102997-removebg-preview.png" />
    <div>
      <div id="counter2" style="font-size: 16px;">0</div>
      <div id="rateText" style="font-size: 12px; color: #0ff;">+0/h üöÄ</div>
    </div>
  </div>
</div>
<!-- ‚úÖ Right Corner Buttons -->
<div class="right-buttons">
  <button onclick="showSection('upgradeCoinSection')">üìà Upgrade Coin</button>
  <button onclick="showSection('autoTapSection')">‚õèÔ∏è Auto Tap</button>
</div>
<!-- üîÅ All Sections -->
<div class="section" id="tapSection">
  <div class="main-section">
    <h1>Tap and Earn</h1>
    <div class="energy-bar">
      <div class="energy-fill"></div>
      <span class="energy-text">1000 / 1000</span>
    </div>
    <div class="coin-wrapper" id="coin">
      <img src="https://i.ibb.co/sp2XG3DZ/1000099106-removebg-preview.png" />
    </div>
  </div>
</div>
<div class="section" id="autoTapSection">
  <h2 style="text-align:center; margin-top: 120px;">‚õèÔ∏è Auto Tap Packs</h2>
  <div style="text-align:center; margin-top: 20px;">
    <p>Auto Tap Speed: <b>0.1 sec</b></p>

    <button class="auto-tap-btn" onclick="buyAutoTap(10 * 60 * 1000, 5000, 'MSHYA')">üîì 10 min ‚Äî 5000 MSHYA</button><br><br>
    <button class="auto-tap-btn" onclick="buyAutoTap(2 * 60 * 60 * 1000, 60000, 'MSHYA')">üîì 2 hrs ‚Äî 60000 MSHYA</button><br><br>
    <button class="auto-tap-btn" onclick="buyAutoTap(12 * 60 * 60 * 1000, 400000, 'MSHYA')">üîì 12 hrs ‚Äî 400000 MSHYA</button><br><br>
    <button class="auto-tap-btn" onclick="buyAutoTap(24 * 60 * 60 * 1000, 700000, 'MSHYA')">üîì 24 hrs ‚Äî 700000 MSHYA</button><br><br>

    <p id="autoTapStatus">Status: <span style="color:red;">OFF</span></p>
    <p>Time Left: <span id="autoTapTimer">-</span></p>
  </div>
</div>
<!-- ‚úÖ UPGRADE SECTION -->
<div class="section" id="upgradeSection">
  <div class="main-section">
    <h2 style="margin-bottom: 16px;">üöÄ Vehicle Upgrade</h2>
    <div id="upgradeContainer" style="text-align: center; padding: 20px; background: rgba(0,0,0,0.6); border-radius: 16px; box-shadow: 0 0 12px cyan;">
      <div style="font-size: 42px;" id="partEmoji">üõû</div>
      <div style="margin: 10px 0; font-size: 14px; color: #ccc;">
        Upgrade #<span id="partLevel">1</span>/9999
      </div>
      <div style="margin-bottom: 10px; color: #0ff;">
        Profit Boost: +<span id="profitAmount">0</span>/h üöÄ
      </div>
      <div style="margin-bottom: 20px; color: #ff0;">
        Price: <span id="priceAmount">500</span> MSHYA üí∞
      </div>
      <button onclick="buyUpgrade()" style="padding: 10px 20px; background: #00bfff; border: none; color: #fff; font-weight: bold; border-radius: 12px; cursor: pointer;">
        Buy Upgrade
      </button>
    </div>
  </div>
</div>

<!-- üìà Upgrade Coin Section --><div class="section" id="upgradeCoinSection">
  <h2 style="text-align:center; margin-top: 120px; color:#00ffd5;">üìà Upgrade Coin Section</h2>
  <div class="coin-upgrade-box" style="text-align:center; margin-top: 20px; background:#1a1a1a; padding:20px; border-radius:12px; max-width:500px; margin:auto; border:1px solid #333;">
    <p>üîº <strong>Coin Tap Power:</strong> <span id="tapPower">1</span></p>
    <p>üí∞ <strong>Upgrade Cost:</strong> <span id="coinUpgradeCost">500</span> MSHYA</p>
    <button onclick="upgradeCoinTap()" style="padding: 10px 20px; background: #ffcc00; border: none; color: #000; font-weight: bold; border-radius: 12px; cursor: pointer; margin-top: 15px;">
      Upgrade Coin Power
    </button>
  </div>  
<!-- ‚ö° Energy Recovery Packs Section -->  
<div id="energyPackButtons" style="margin-top: 50px;">
  <h3 style="text-align:center; color:#00ffd5;">‚ö° Energy Recovery Packs</h3>

  <div style="background:#1a1a1a; padding:15px; margin:15px auto; max-width:500px; border-radius:12px; border:1px solid #333; text-align:center;">
    <h4>‚ö° 4s Recovery</h4>
    <p>Lifetime ‚Ä¢ Cost: <b>10,000 MSHYA</b></p>
    <button id="buyPack1" onclick="buyEnergyPack(1)" style="background:#00ffd5; color:black; border:none; padding:10px 15px; border-radius:10px; font-weight:bold; cursor:pointer;">Buy</button>
  </div>

  <div style="background:#1a1a1a; padding:15px; margin:15px auto; max-width:500px; border-radius:12px; border:1px solid #333; text-align:center;">
    <h4>‚ö° 3s Recovery</h4>
    <p>Lifetime ‚Ä¢ Cost: <b>25,000 MSHYA</b></p>
    <button id="buyPack2" onclick="buyEnergyPack(2)" style="background:#00ffd5; color:black; border:none; padding:10px 15px; border-radius:10px; font-weight:bold; cursor:pointer;">Buy</button>
  </div>

  <div style="background:#1a1a1a; padding:15px; margin:15px auto; max-width:500px; border-radius:12px; border:1px solid #333; text-align:center;">
    <h4>‚ö° 2s Recovery</h4>
    <p>Lifetime ‚Ä¢ Cost: <b>50,000 MSHYA</b></p>
    <button id="buyPack3" onclick="buyEnergyPack(3)" style="background:#00ffd5; color:black; border:none; padding:10px 15px; border-radius:10px; font-weight:bold; cursor:pointer;">Buy</button>
  </div>

  <div style="background:#1a1a1a; padding:15px; margin:15px auto; max-width:500px; border-radius:12px; border:1px solid #333; text-align:center;">
    <h4>‚ö° 1s Recovery</h4>
    <p>Lifetime  ‚Ä¢ Cost: <b>100000 MSHYA</b></p>
    <button id="buyPack4" onclick="buyEnergyPack(4)" style="background:#00ffd5; color:black; border:none; padding:10px 15px; border-radius:10px; font-weight:bold; cursor:pointer;">Buy</button>
  </div>

  <div style="background:#1a1a1a; padding:15px; margin:15px auto; max-width:500px; border-radius:12px; border:1px solid #333; text-align:center;">
    <h4>‚ö° Instant Recovery</h4>
    <p>Lifetime  ‚Ä¢ Cost: <b>999999 MSHYA</b></p>
    <button id="buyPack5" onclick="buyEnergyPack(5)" style="background:#00ffd5; color:black; border:none; padding:10px 15px; border-radius:10px; font-weight:bold; cursor:pointer;">Buy</button>
  </div>
</div>
</div>


<!-- üì£ Refer Section -->
<div class="section" id="referSection" style="display: none;">
  <div class="main-section" style="margin-top: 100px; text-align: center;">
    <img src="https://i.ibb.co/JwvKv80V/1000102997-removebg-preview.png" alt="Refer and Earn" style="width: 200px; margin-bottom: 20px;" /><h2 style="color: #00ffff; font-size: 20px; margin-bottom: 10px;">üéÅ Refer your friend for friendship </h2>

<div style="display: flex; justify-content: center; align-items: center; margin-bottom: 20px;">
  <input id="refLink" type="text" readonly value="https://t.me/Shyamining_bot?start=" 
         style="width: 260px; padding: 8px 10px; border-radius: 10px 0 0 10px; border: none; outline: none; font-size: 14px;">
  <button onclick="copyRefLink()" 
          style="padding: 8px 15px; background: #00bfff; color: white; font-weight: bold; border: none; border-radius: 0 10px 10px 0; cursor: pointer;">
    COPY 
  </button>
</div>


  </div>
</div>
<!-- SHOP SECTION -->
<div class="shop-section section" id="shop">
  <h2 class="shop-heading">üõí MSHYA Coin Shop</h2>

  <!-- Package 1 -->
  <div class="shop-row">
    <img src="https://i.ibb.co/wZDGj5Xy/file-000000008f84622f93729c1d425779dd.png" class="shop-logo" />
    <div class="shop-amount">100,000 MSHYA</div>
    <div class="shop-price">0.001 TON</div>
    <button class="shop-buy">Buy</button>
  </div>

  <!-- Package 2 to 11 -->
  <div class="shop-row">
    <img src="https://i.ibb.co/wZDGj5Xy/file-000000008f84622f93729c1d425779dd.png" class="shop-logo" />
    <div class="shop-amount">1,000,000 MSHYA</div>
    <div class="shop-price">1 TON</div>
    <button class="shop-buy">Buy</button>
  </div>
  <div class="shop-row">
    <img src="https://i.ibb.co/wZDGj5Xy/file-000000008f84622f93729c1d425779dd.png" class="shop-logo" />
    <div class="shop-amount">2,000,000 MSHYA</div>
    <div class="shop-price">2 TON</div>
    <button class="shop-buy">Buy</button>
  </div>
  <div class="shop-row">
    <img src="https://i.ibb.co/wZDGj5Xy/file-000000008f84622f93729c1d425779dd.png" class="shop-logo" />
    <div class="shop-amount">3,000,000 MSHYA</div>
    <div class="shop-price">3 TON</div>
    <button class="shop-buy">Buy</button>
  </div>
  <div class="shop-row">
    <img src="https://i.ibb.co/wZDGj5Xy/file-000000008f84622f93729c1d425779dd.png" class="shop-logo" />
    <div class="shop-amount">4,000,000 MSHYA</div>
    <div class="shop-price">4 TON</div>
    <button class="shop-buy">Buy</button>
  </div>
  <div class="shop-row">
    <img src="https://i.ibb.co/wZDGj5Xy/file-000000008f84622f93729c1d425779dd.png" class="shop-logo" />
    <div class="shop-amount">5,000,000 MSHYA</div>
    <div class="shop-price">5 TON</div>
    <button class="shop-buy">Buy</button>
  </div>
  <div class="shop-row">
    <img src="https://i.ibb.co/wZDGj5Xy/file-000000008f84622f93729c1d425779dd.png" class="shop-logo" />
    <div class="shop-amount">6,000,000 MSHYA</div>
    <div class="shop-price">6 TON</div>
    <button class="shop-buy">Buy</button>
  </div>
  <div class="shop-row">
    <img src="https://i.ibb.co/wZDGj5Xy/file-000000008f84622f93729c1d425779dd.png" class="shop-logo" />
    <div class="shop-amount">7,000,000 MSHYA</div>
    <div class="shop-price">7 TON</div>
    <button class="shop-buy">Buy</button>
  </div>
  <div class="shop-row">
    <img src="https://i.ibb.co/wZDGj5Xy/file-000000008f84622f93729c1d425779dd.png" class="shop-logo" />
    <div class="shop-amount">8,000,000 MSHYA</div>
    <div class="shop-price">8 TON</div>
    <button class="shop-buy">Buy</button>
  </div>
  <div class="shop-row">
    <img src="https://i.ibb.co/wZDGj5Xy/file-000000008f84622f93729c1d425779dd.png" class="shop-logo" />
    <div class="shop-amount">9,000,000 MSHYA</div>
    <div class="shop-price">9 TON</div>
    <button class="shop-buy">Buy</button>
  </div>
  <div class="shop-row">
    <img src="https://i.ibb.co/wZDGj5Xy/file-000000008f84622f93729c1d425779dd.png" class="shop-logo" />
    <div class="shop-amount">10,000,000 MSHYA</div>
    <div class="shop-price">10 TON</div>
    <button class="shop-buy">Buy</button>
  </div>
</div>

<!-- üìã Task Section -->
<div class="section" id="taskSection">
  <h2 style="text-align:center; margin-top: 120px;">üìã Task Section</h2>  <div class="task-card">
    <img src="https://i.ibb.co/Fk7bm6Pn/file-00000000b1a061f9aeb5ca6677c6dccd.png" class="task-icon">
    <div class="task-text">
      <strong>Follow on Instagram</strong><br>
      +100 SHYA
    </div>
    <button class="task-btn" onclick="handleTask('instagram')">Start</button>
  </div>  <div class="task-card">
    <img src="https://i.ibb.co/p6wgxb6C/file-00000000cdac61f89ac98cdfa64783b2.png" class="task-icon">
    <div class="task-text">
      <strong>Subscribe on YouTube</strong><br>
      +100 SHYA
    </div>
    <button class="task-btn" onclick="handleTask('youtube')">Start</button>
  </div>
</div>
<!-- üîª Bottom Nav -->
<div class="bottom-images">
  <div class="image-box" onclick="showSection('referSection')">
    <img src="https://i.ibb.co/4gT0LtCx/file-00000000babc61fa95044694319b4acc.png" />
  </div>
  <div class="image-box" onclick="showSection('shop')">
    <img src="https://i.ibb.co/wFmmgqw4/file-00000000a040624684c00386cac32f9a.png" />
  </div>
  <div class="image-box" onclick="showSection('tapSection')">
    <img src="https://i.ibb.co/MDsF4TLd/file-000000006ff061f6a1fcc874279b2442.png" />
  </div>
  <div class="image-box" onclick="showSection('upgradeSection')">
    <img src="https://i.ibb.co/HTPHpRrf/file-000000007f1c62468208ec1081af5112.png" />
  </div>
  <div class="image-box" onclick="showSection('taskSection')">
    <img src="https://i.ibb.co/TB8txjk7/file-0000000060dc6243bd495498d16db889.png" />
  </div>
</div>


<!-- ‚úÖ JS -->
<script>
const supabaseUrl = 'https://vaxelepziqqpteyqokrc.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InZheGVsZXB6aXFxcHRleXFva3JjIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQwMTQ3NDcsImV4cCI6MjA2OTU5MDc0N30.tRTdbffdk2Xcq-2YxlZZM2TkYahuhJnrRjesKy-dptQ';
    const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);


// ‚úÖ ‡§∏‡§ø‡§∞‡•ç‡§´ LocalStorage ‡§∏‡•á User ID ‡§¨‡§®‡§æ‡§ì ‡§î‡§∞ ‡§á‡§∏‡•ç‡§§‡•á‡§Æ‡§æ‡§≤ ‡§ï‡§∞‡•ã
let userId = '';

// üîÑ Function to create user if not exists
async function createUserIfNotExist() {
  // Try to get from localStorage
  userId = localStorage.getItem('user_id');

  // ‡§Ö‡§ó‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ, ‡§§‡•ã ‡§®‡§Ø‡§æ ‡§¨‡§®‡§æ‡§ì ‡§î‡§∞ save ‡§ï‡§∞‡•ã
  if (!userId) {
    userId = 'user_' + Math.floor(Math.random() * 100000000);
    localStorage.setItem('user_id', userId);
  }

  // Supabase ‡§Æ‡•á‡§Ç ‡§ö‡•á‡§ï ‡§ï‡§∞‡•ã user exists ‡§π‡•à ‡§Ø‡§æ ‡§®‡§π‡•Ä‡§Ç
  const { data, error } = await supabase
    .from('users')
    .select('id')
    .eq('id', userId)
    .single();

  // ‡§Ö‡§ó‡§∞ ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à, ‡§§‡•ã ‡§®‡§Ø‡§æ insert ‡§ï‡§∞‡•ã
  if (!data) {
    await supabase.from('users').insert([{ id: userId }]);
  }

  console.log("‚úÖ User ID Set:", userId);
}



// ========================= üîÅ Global Variables =========================
let mshya = parseInt(localStorage.getItem("mshya")) || 0;
let totalShya = parseFloat(localStorage.getItem("totalShya")) || 0;
let shyaPerHour = parseInt(localStorage.getItem("shyaPerHour")) || 0;
let energy = parseInt(localStorage.getItem("energy")) || 1000;
const maxEnergy = 1000;

let upgradeLevel = parseInt(localStorage.getItem("upgradeLevel")) || 1;
let currentPrice = parseInt(localStorage.getItem("currentPrice")) || 500;
let currentProfit = 0;
let tapPower = parseInt(localStorage.getItem("tapPower") || "1");
let coinUpgradeCost = parseInt(localStorage.getItem("coinUpgradeCost") || "500");
let lastTapTime = 0;
let energyRecoverySpeed = parseInt(localStorage.getItem("energyRecoverySpeed")) || 5;
let energyInterval;
const mshyaDisplay = document.getElementById("counter1");
const shyaDisplay = document.getElementById("counter2");

const emojis = [ "ü•ê","ü´ì","üçû","üçü","üíé","üí∞","üßÄ","üíµ","üí∏","ü™ô", "üíΩ","üíæ","üñ±Ô∏è","üñ®Ô∏è","‚å®Ô∏è","üíª","üñ•Ô∏è","üîå","üì†","üìü", "üì±","‚òéÔ∏è","üìû","üóùÔ∏è","üõ°Ô∏è","üó°Ô∏è","‚öîÔ∏è","üñáÔ∏è","üìé","‚õìÔ∏è", "üîó","‚õìÔ∏è‚Äçüí•","‚öôÔ∏è","‚õèÔ∏è","‚öíÔ∏è","üõ†Ô∏è","üëΩ","ü™®","ü™µ","üö®", "‚õΩ","üõ¢Ô∏è","üß≠","üõû","üõü","‚öì","üõë","‚úàÔ∏è","üõ©Ô∏è","üöÅ","üõ∏","üöÄ"];

let tasksCompleted = JSON.parse(localStorage.getItem("tasksCompleted")) || {
  instagram: "none",
  youtube: "none"
};

// ========================= ‚ö° Energy =========================
function updateEnergyUI() {
  const fill = document.querySelector('.energy-fill');
  const text = document.querySelector('.energy-text');
  const percentage = (energy / maxEnergy) * 100;
  fill.style.width = percentage + '%';
  text.innerText = `${energy} / ${maxEnergy}`;
}

function startEnergyRecovery() {
  if (energyInterval) clearInterval(energyInterval);

  energyRecoverySpeed = parseFloat(localStorage.getItem("energyRecoverySpeed")) || 5;
  const delay = energyRecoverySpeed * 1000;

  if (delay <= 0 || isNaN(delay)) {
    console.warn("‚ùå Invalid energyRecoverySpeed:", energyRecoverySpeed);
    return;
  }

  energyInterval = setInterval(() => {
    if (energy < maxEnergy) {
      energy++;
      localStorage.setItem("lastEnergyUpdate", Date.now()); // ‚úÖ ‡§Ø‡•á ‡§≤‡§æ‡§á‡§® ‡§ú‡§∞‡•Ç‡§∞‡•Ä ‡§π‡•à
      updateEnergyUI();
      saveData();
    }
  }, delay);
}

// ========================= üöÄ Passive SHYA Profit =========================
setInterval(() => {
  totalShya += shyaPerHour / 3600;
  updateShyaDisplay();
  saveData();
}, 1000);
// =========================SHOP==============================================
// ‚úÖ ‡§∏‡§≠‡•Ä "Buy" ‡§¨‡§ü‡§® ‡§ï‡•ã ‡§∏‡•á‡§≤‡•á‡§ï‡•ç‡§ü ‡§ï‡§∞‡•ã
const buyButtons = document.querySelectorAll(".shop-buy");

// ‚úÖ ‡§π‡§∞ ‡§¨‡§ü‡§® ‡§™‡§∞ click event listener ‡§≤‡§ó‡§æ‡§ì
buyButtons.forEach(button => {
  button.addEventListener("click", () => {
    // ‚úÖ ‡§ú‡§¨ ‡§≠‡•Ä ‡§ï‡•ã‡§à buy ‡§¨‡§ü‡§® ‡§¶‡§¨‡•á
    alert("Don't waste your money. Play the game and earn. Airdrop coming soon!");
  });
});

function copyRefLink() {
  const refInput = document.getElementById("refLink");
  refInput.select();
  refInput.setSelectionRange(0, 99999); // ‡§Æ‡•ã‡§¨‡§æ‡§á‡§≤ ‡§ï‡•á ‡§≤‡§ø‡§è

  document.execCommand("copy");

  // Optional: ‡§Ø‡•Ç‡§ú‡§º‡§∞ ‡§ï‡•ã feedback ‡§¶‡•á‡§®‡§æ
  alert("üìã Referral link copied!");
}
// ========================= üí∞ Tap =========================
function handleTap(event) {
  const now = Date.now();
  if (now - lastTapTime < 50) return;
  lastTapTime = now;

  if (energy <= 0) {
    alert("‚ö†Ô∏è Energy over! Please wait.");
    return;
  }

  energy--;
  mshya += tapPower;
  updateEnergyUI();
  updateUpgradeUI();
  saveData();

  const tapText = document.createElement("div");
  tapText.className = "tap-text";
  tapText.innerText = `+${tapPower} MSHYA`;
  tapText.style.left = event.clientX + "px";
  tapText.style.top = event.clientY + "px";
  document.body.appendChild(tapText);
  setTimeout(() => tapText.remove(), 1000);
}

let autoTapEnabled = localStorage.getItem("autoTapEnabled") === "true";
let autoTapExpiry = parseInt(localStorage.getItem("autoTapExpiry")) || 0;
let autoTapInterval;
let autoTapSpeed = 100; // 0.1 sec

function buyAutoTap(durationMs, cost) {
  if (mshya >= cost) {
    mshya -= cost;
  } else {
    alert("‚ùå Not enough MSHYA balance.");
    return;
  }

  autoTapEnabled = true;
  autoTapExpiry = Date.now() + durationMs;

  localStorage.setItem("autoTapEnabled", "true");
  localStorage.setItem("autoTapExpiry", autoTapExpiry.toString());
  saveData();
  startAutoTap();
  alert("‚úÖ Auto Tap Activated for " + (durationMs / 60000).toFixed(0) + " min");
}

function startAutoTap() {
  if (autoTapInterval) clearInterval(autoTapInterval);
  if (!autoTapEnabled) return;

  autoTapInterval = setInterval(() => {
    if (Date.now() > autoTapExpiry) {
      autoTapEnabled = false;
      localStorage.setItem("autoTapEnabled", "false");
      document.getElementById("autoTapStatus").innerHTML = `<span style="color:red;">OFF</span>`;
      document.getElementById("autoTapTimer").innerText = "-";
      clearInterval(autoTapInterval);
      return;
    }

    handleTap(); // üëà existing tap logic
    localStorage.setItem("lastAutoTapCollect", Date.now());
    updateAutoTapUI();
  }, autoTapSpeed);
}

function updateAutoTapUI() {
  document.getElementById("autoTapStatus").innerHTML = `<span style="color:green;">ON</span>`;
  let remaining = autoTapExpiry - Date.now();
  if (remaining > 0) {
    let mins = Math.floor(remaining / 60000);
    let secs = Math.floor((remaining % 60000) / 1000);
    document.getElementById("autoTapTimer").innerText = `${mins}m ${secs}s`;
  }
}

setInterval(() => {
  if (autoTapEnabled) updateAutoTapUI();
}, 1000); // update timer every second

// On game start
if (autoTapEnabled && Date.now() < autoTapExpiry) {
  startAutoTap();
} else {
  autoTapEnabled = false;
  localStorage.setItem("autoTapEnabled", "false");
}

// ========================= üîß Upgrade Section =========================
function buyUpgrade() {
  if (mshya < currentPrice) {
    alert("‚ùå Not enough MSHYA!");
    return;
  }

  mshya -= currentPrice;
  const base = 100 + upgradeLevel * 5;
  const randomBoost = Math.floor(Math.random() * 20);
  const profitBoost = base + randomBoost;

  shyaPerHour += profitBoost;
  currentProfit = profitBoost;
  upgradeLevel++;
  currentPrice = Math.floor(500 * Math.pow(1.15, upgradeLevel));

  updateUpgradeUI();
  saveData();
}

function updateUpgradeUI() {
  const emoji = emojis[(upgradeLevel - 1) % emojis.length];
  partEmoji.innerText = emoji;
  partLevel.innerText = upgradeLevel;
  priceAmount.innerText = currentPrice.toLocaleString();
  profitAmount.innerText = currentProfit.toLocaleString();
  mshyaDisplay.innerText = mshya.toLocaleString();
  updateShyaDisplay();
}

// ========================= üîß Tap Power Upgrade =========================
const maxTapPower = 100; // Max limit

function upgradeCoinTap() {
  mshya = parseInt(localStorage.getItem("mshya")) || 0;
  tapPower = parseInt(localStorage.getItem("tapPower")) || 1;

  if (tapPower >= maxTapPower) {
    alert("üö´ Tap Power ‡§™‡§π‡§≤‡•á ‡§∏‡•á ‡§π‡•Ä Max limit (100) ‡§™‡§∞ ‡§π‡•à!");
    return;
  }

  if (mshya >= coinUpgradeCost) {
    tapPower++;
    mshya -= coinUpgradeCost;
    coinUpgradeCost = getRandomPriceIncrease(coinUpgradeCost);

    localStorage.setItem("tapPower", tapPower);
    localStorage.setItem("mshya", mshya);
    localStorage.setItem("coinUpgradeCost", coinUpgradeCost);

    document.getElementById("tapPower").innerText = tapPower;
    document.getElementById("coinUpgradeCost").innerText = coinUpgradeCost.toLocaleString();
    updateCoinBalanceUI();
    updateUpgradeUI();
    updateShyaDisplay();
    updateEnergyUI();

    // Agar max level pe pahuch gaya, to button disable karo
    if (tapPower >= maxTapPower) {
      const upgradeBtn = document.getElementById("upgradeCoinTapBtn");
      if (upgradeBtn) {
        upgradeBtn.innerText = "MAX üîí";
        upgradeBtn.disabled = true;
      }
    }

  } else {
    alert(`ü™ô ‡§Ü‡§™‡§ï‡•á ‡§™‡§æ‡§∏ ‡§™‡§∞‡•ç‡§Ø‡§æ‡§™‡•ç‡§§ MSHYA ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç!\n‡§Ü‡§™‡§ï‡•á ‡§™‡§æ‡§∏: ${mshya.toLocaleString()} üî∏ ‡§ö‡§æ‡§π‡§ø‡§è: ${coinUpgradeCost.toLocaleString()}`);
  }
}

function getRandomPriceIncrease(price) {
  const inc = Math.floor(Math.random() * 5000) + 700;
  return Math.min(price + inc, 999999); // Coin upgrade cost ki upper limit
}

function updateCoinBalanceUI() {
  const coinDisplay = document.getElementById("coinCount");
  if (coinDisplay) {
    coinDisplay.innerText = mshya.toLocaleString();
  }
}

// ========================= üéÅ Task System =========================
function handleTask(platform) {
  const btn = document.querySelector(`button[onclick="handleTask('${platform}')"]`);
  if (tasksCompleted[platform] === "claimed") {
    alert("‡§Ü‡§™‡§®‡•á ‡§™‡§π‡§≤‡•á ‡§π‡•Ä ‡§Ø‡§π ‡§ü‡§æ‡§∏‡•ç‡§ï ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§∞ ‡§≤‡§ø‡§Ø‡§æ ‡§π‡•à!");
    return;
  }

  if (tasksCompleted[platform] === "started") {
    if (confirm("‡§ï‡•ç‡§Ø‡§æ ‡§Ü‡§™‡§®‡•á ‡§ü‡§æ‡§∏‡•ç‡§ï ‡§™‡•Ç‡§∞‡§æ ‡§ï‡§∞ ‡§≤‡§ø‡§Ø‡§æ? Claim ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è OK ‡§¶‡§¨‡§æ‡§è‡§Ç‡•§")) {
      totalShya += 100;
      tasksCompleted[platform] = "claimed";
      btn.innerText = "Claimed ‚úÖ"; btn.disabled = true;
      updateShyaDisplay();
      localStorage.setItem("tasksCompleted", JSON.stringify(tasksCompleted));
      localStorage.setItem("totalShya", totalShya);
    }
    return;
  }

  const urls = {
    instagram: 'https://www.instagram.com/your_page',
    youtube: 'https://www.youtube.com/your_channel'
  };
  window.open(urls[platform], '_blank');

  btn.innerText = "Waiting... ‚è≥";
  btn.disabled = true;
  tasksCompleted[platform] = "started";
  localStorage.setItem("tasksCompleted", JSON.stringify(tasksCompleted));

  setTimeout(() => {
    btn.innerText = "Claim";
    btn.disabled = false;
  }, 5000);
}

 
// ========================= üõí Energy Pack Purchase =========================
// ‚úÖ Initialization: ‡§Ö‡§ó‡§∞ ‡§™‡§π‡§≤‡•á ‡§∏‡•á coin ‡§®‡§π‡•Ä‡§Ç ‡§π‡•à‡§Ç, ‡§§‡•ã 0 ‡§∏‡•á ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•ã
if (localStorage.getItem("mshya") === null) {
  localStorage.setItem("mshya", "0");
}
if (localStorage.getItem("energy") === null) {
  localStorage.setItem("energy", "1000");
}
if (localStorage.getItem("energyRecoverySpeed") === null) {
  localStorage.setItem("energyRecoverySpeed", "5");
}

// ‚úÖ Global Variables

// ‚úÖ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ Coin balance ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•ã
function updateCoinBalanceUI() {
  const el = document.getElementById("mshyaBalance");
  if (el) {
    el.innerText = Math.floor(mshya).toLocaleString();
  }
}

// ‚úÖ ‡§∏‡•ç‡§ï‡•ç‡§∞‡•Ä‡§® ‡§™‡§∞ Energy UI ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•ã
function updateEnergyUI() {
  const fill = document.querySelector(".energy-fill");
  const text = document.querySelector(".energy-text");
  const percentage = (energy / maxEnergy) * 100;
  if (fill) fill.style.width = percentage + "%";
  if (text) text.innerText = `${energy} / ${maxEnergy}`;
}

// ‚úÖ Energy Recovery ‡§ö‡§æ‡§≤‡•Ç ‡§ï‡§∞‡•ã
function startEnergyRecovery() {
  if (energyInterval) clearInterval(energyInterval);
  const delay = energyRecoverySpeed * 1000;
  if (delay <= 0 || isNaN(delay)) return;

  energyInterval = setInterval(() => {
    if (energy < maxEnergy) {
      energy++;
      localStorage.setItem("energy", energy.toString());
      updateEnergyUI();
    }
  }, delay);
}

// ‚úÖ Energy Packs Data
const packs = {
  1: { cost: 10000, speed: 4 },
  2: { cost: 25000, speed: 3 },
  3: { cost: 50000, speed: 2 },
  4: { cost: 100000, speed: 1 },
  5: { cost: 999999, speed: 0.1 }
};

// ‚úÖ ‡§è‡§ï‡•ç‡§ü‡§ø‡§µ‡•á‡§ü‡•á‡§° ‡§™‡•à‡§ï UI ‡§¶‡§ø‡§ñ‡§æ‡§ì
function checkActiveEnergyPacks() {
  const activatedPack = localStorage.getItem("activatedPack");
  if (activatedPack) {
    const btn = document.querySelector(`#buyPack${activatedPack}`);
    if (btn) {
      btn.innerText = "Activated ‚úÖ";
      btn.disabled = true;
    }
  }
}

// ‚úÖ Pack ‡§ñ‡§∞‡•Ä‡§¶‡§®‡•á ‡§ï‡§æ Function
function buyEnergyPack(option) {
  const pack = packs[option];
  if (!pack) {
    alert("‚ùå Invalid pack option");
    return;
  }

  const btn = document.querySelector(`#buyPack${option}`);
  if (!btn) {
    alert("‚ùå Button not found");
    return;
  }

  if (mshya < pack.cost) {
    alert("‚ùå Not enough MSHYA balance");
    return;
  }

  // ‚úÖ Coins ‡§ï‡§æ‡§ü‡•ã
  mshya -= pack.cost;
  localStorage.setItem("mshya", mshya.toString());

  // ‚úÖ Recovery Speed ‡§∏‡•á‡§ü ‡§ï‡§∞‡•ã
  energyRecoverySpeed = pack.speed;
  localStorage.setItem("energyRecoverySpeed", energyRecoverySpeed.toString());

  // ‚úÖ Activated Pack save ‡§ï‡§∞‡•ã
  localStorage.setItem("activatedPack", option);

  // ‚úÖ UI ‡§Ö‡§™‡§°‡•á‡§ü ‡§ï‡§∞‡•ã
  btn.innerText = "Activated ‚úÖ";
  btn.disabled = true;
  updateCoinBalanceUI();

  alert(`‚úÖ Pack ${option} Activated!`);

  // ‚úÖ Energy recovery ‡§¶‡•ã‡§¨‡§æ‡§∞‡§æ ‡§ö‡§æ‡§≤‡•Ç ‡§ï‡§∞‡•ã
  startEnergyRecovery();
}

// ‚úÖ Tap Button Function (‡§â‡§¶‡§æ‡§π‡§∞‡§£)
function onTap() {
  if (energy <= 0) {
    alert("‚ùå Not enough energy");
    return;
  }

  mshya += 1;
  energy -= 1;

  localStorage.setItem("mshya", mshya.toString());
  localStorage.setItem("energy", energy.toString());

  updateCoinBalanceUI();
  updateEnergyUI();
}

// ‚úÖ ‡§™‡•á‡§ú ‡§≤‡•ã‡§° ‡§™‡§∞ ‡§∏‡§¨ initialize ‡§ï‡§∞‡•ã
updateCoinBalanceUI();
updateEnergyUI();
checkActiveEnergyPacks();
startEnergyRecovery();
// ========================= üíæ Save & Reset =========================
// üîÑ Game Save function
async function saveData() {
  localStorage.setItem("mshya", mshya);
  localStorage.setItem("totalShya", totalShya);
  localStorage.setItem("shyaPerHour", shyaPerHour);
  localStorage.setItem("upgradeLevel", upgradeLevel);
  localStorage.setItem("currentPrice", currentPrice);
  localStorage.setItem("energy", energy);
  localStorage.setItem("tapPower", tapPower);
  localStorage.setItem("coinUpgradeCost", coinUpgradeCost);
  localStorage.setItem("lastEnergyUpdate", Date.now());
  localStorage.setItem("lastEnergyUpdateTime", Date.now().toString());

  if (userId) {
    const { error } = await supabase
      .from('users')
      .update({
        mshya: mshya,
        total_shya: totalShya,
        shya_per_hour: shyaPerHour,
        upgrade_level: upgradeLevel,
        energy: energy,
        tap_power: tapPower
      })
      .eq('id', userId);

    if (error) {
      console.error("‚ùå Supabase Update Error:", error.message);
    } else {
      console.log("‚úÖ Supabase Updated for user:", userId);
    }
  }
}


// ========================= üñ•Ô∏è UI Display =========================
function updateShyaDisplay() {
  if (shyaDisplay) shyaDisplay.innerText = Math.floor(totalShya).toLocaleString();
  if (rateText) rateText.innerText = `+${shyaPerHour}/h üöÄ`;
  if (mshyaDisplay) mshyaDisplay.innerText = mshya.toLocaleString();
}
function showSection(id) {
  document.querySelectorAll(".section").forEach(sec => sec.style.display = "none");
  const active = document.getElementById(id);
  if (active) active.style.display = "block";
}


// ========================= üîÅ On Page Load =========================
document.addEventListener("DOMContentLoaded", () => {
  const now = Date.now();

  // üí∞ SHYA Offline Earnings
  const lastCollected = localStorage.getItem("lastCollectedTime");
  if (lastCollected) {
    const seconds = Math.floor((now - parseInt(lastCollected)) / 1000);
    const offlineEarnings = Math.floor((shyaPerHour / 3600) * seconds);
    if (offlineEarnings > 0) {
      totalShya += offlineEarnings;
      alert(`üí∞ ‡§Ü‡§™‡§®‡•á ‡§ë‡§´‡§≤‡§æ‡§á‡§® ‡§∞‡§π‡§§‡•á ‡§π‡•Å‡§è ${offlineEarnings} SHYA ‡§ï‡§Æ‡§æ‡§è!`);
    }
  }
  localStorage.setItem("lastCollectedTime", now.toString());

  // ü§ñ Auto Tap ‡§ï‡•Ä ‡§ë‡§´‡§≤‡§æ‡§á‡§® ‡§ï‡§Æ‡§æ‡§à (‡§Ö‡§¨ MSHYA ‡§Æ‡•á‡§Ç ‚Äî Fixed)
  const autoTapEnabledStored = localStorage.getItem("autoTapEnabled") === "true";
  const autoTapExpiry = parseInt(localStorage.getItem("autoTapExpiry")) || 0;
  const autoTapSpeed = 100;
  const lastTapTimeStored = parseInt(localStorage.getItem("lastTapTime")) || now;

  const autoTapWasActive = autoTapExpiry > lastTapTimeStored;
  if (autoTapEnabledStored || autoTapWasActive) {
    const effectiveEndTime = Math.min(now, autoTapExpiry);
    const offlineDuration = effectiveEndTime - lastTapTimeStored;
    const totalTaps = Math.floor(offlineDuration / autoTapSpeed);
    const earned = totalTaps * tapPower;

    if (earned > 0) {
      mshya += earned;
      alert(`ü§ñ Auto Tap ‡§®‡•á ‡§ë‡§´‡§≤‡§æ‡§á‡§® ‡§∞‡§π‡§§‡•á ‡§π‡•Å‡§è ${earned} MSHYA ‡§ï‡§Æ‡§æ‡§è!`);
    }

    localStorage.setItem("lastTapTime", now.toString());
  }

  // ‚ö° Energy Offline Recovery
  const lastEnergyTime = parseInt(localStorage.getItem("lastEnergyUpdateTime"));
  const storedSpeed = parseFloat(localStorage.getItem("energyRecoverySpeed")) || 5;
  if (lastEnergyTime && storedSpeed > 0) {
    const elapsed = Math.floor((now - lastEnergyTime) / 1000);
    const recovered = Math.floor(elapsed / storedSpeed);
    if (recovered > 0 && energy < maxEnergy) {
      energy = Math.min(energy + recovered, maxEnergy);
    }
  }
  localStorage.setItem("lastEnergyUpdateTime", now.toString());

  // üéÆ Event Listeners & UI Setup
  document.getElementById("coin")?.addEventListener("click", handleTap);
  document.getElementById("coin")?.addEventListener("touchstart", handleTap);
  document.getElementById("resetButton")?.addEventListener("click", resetProgress);

  ["instagram", "youtube"].forEach(platform => {
    const btn = document.querySelector(`button[onclick="handleTask('${platform}')"]`);
    const status = tasksCompleted[platform];
    btn.innerText = status === "claimed" ? "Claimed ‚úÖ" : (status === "started" ? "Claim" : "Start");
    btn.disabled = status === "claimed";
  });

  document.getElementById("coinUpgradeCost").innerText = coinUpgradeCost.toLocaleString();

  // üîÑ UI Refresh
  updateUpgradeUI();
  updateEnergyUI();
  updateShyaDisplay();
  updateCoinBalanceUI();

  // üîÅ Systems Start
  startAutoTap();
  checkActiveEnergyPacks();
  createUserIfNotExist();
  startEnergyRecovery();
});
window.addEventListener("beforeunload", () => {
  localStorage.setItem("lastCollectedTime", Date.now().toString());
  localStorage.setItem("lastEnergyUpdateTime", Date.now().toString());
  localStorage.setItem("lastTapTime", Date.now().toString());
});

</script>

</body>
</html>
